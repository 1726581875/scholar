<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½œä¸šæäº¤é¡µé¢</title>
    <link href="http://res.scholat.com/scholat/course/styles/T_BackManager.gzcss?_dc=e6e9b591575" rel="stylesheet"
        type="text/css" />
    <link href="http://res.scholat.com/scholat/course/styles/T_BackToolbar.gzcss?_dc=58b86543e2b" rel="stylesheet"
        type="text/css" />
    <link href="http://res.scholat.com/scholat/portal/styles/portalTop.gzcss?_dc=c66acc21bf1" rel="stylesheet"
        type="text/css" />
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.0.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
    <script src="http://libs.baidu.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
</head>

<body>
    <!--åŠŸèƒ½é€‰æ‹© å…¬å…±ä»£ç  -->
    <div class="head" style="padding-bottom: 5px; text-align: center;">
        <div style="display: inline;">
            <div class="head-title">
                <!-- è¯¾ç¨‹åå­— -->
            </div>
            <div id="msgImg" class="head-notice">
                <div style="width: 135px; float: right; cursor: pointer">
                    æ¬¢è¿æ‚¨ï¼Œ<span id="username"></span>&nbsp;&nbsp;
                </div>
            </div>
        </div>
        <div class="head-toolbar">
            <div id="lnews" class="head-toolbar-item head-toolbar-item-news"
                onClick="javascript:window.location.href='/course/T_latestNews.html?courseId=2954'">
                <div class="head-toolbar-item-detail">
                    æœ€æ–°åŠ¨æ€
                    <div style="font-size: 12px;">
                        What's New
                    </div>
                </div>
            </div>
            <div id="nlist" class="head-toolbar-item head-toolbar-item-notice"
                onClick="javascript:window.location.href='/course/T_noticeList.html?courseId=2954'">
                <div class="head-toolbar-item-detail">
                    æ•™å­¦å…¬å‘Š
                    <div style="font-size: 12px;">
                        Alerts
                    </div>
                </div>
            </div>
            <div id="tresou" class="head-toolbar-item head-toolbar-item-resource"
                onClick="javascript:window.location.href='/course/T_allResources.html?courseId=2954'">
                <div class="head-toolbar-item-detail w1">
                    æ•™å­¦èµ„æº
                    <div style="font-size: 12px;">
                        Resources
                    </div>
                </div>
            </div>
            <div id="homeWork" class="head-toolbar-item head-toolbar-item-homework">
                <div class="head-toolbar-item-detail w2" style="margin-left: -39px;">
                    è¯¾ç¨‹ä½œä¸š
                    <div style="font-size: 12px;">
                        Homework
                    </div>
                </div>
            </div>
            <div id="ques" class="head-toolbar-item head-toolbar-item-question"
                onClick="window.location.href='../question/AllQuestion.html'">
                <div class="head-toolbar-item-detail">
                    äº’åŠ¨äº¤æµ
                    <div style="font-size: 12px;">
                        Interaction
                    </div>
                </div>
            </div>

            <div id="cinfo" class="head-toolbar-item head-toolbar-item-courseInfo"
                onClick="window.location.href='/course/T_editCourseInfo.html?courseId=2954'">
                <div class="head-toolbar-item-detail w3">
                    ç­çº§ä¿¡æ¯
                    <div style="font-size: 12px;">
                        Management
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- å¸ƒå±€ -->
    <div class="container">
        <div class="row clearfix">
            <div class="col-md-12 column">
                <!-- æç¤ºä¿¡æ¯ -->
                <div class="alert alert-danger" role="alert">
                    æ¸©é¦¨æç¤ºï¼šå½“æ‚¨å‡ºç°æ— æ³•ä¸Šä¼ ä½œä¸šæ—¶ï¼Œè¯·æ›´æ¢æµè§ˆå™¨ï¼Œæ¯”å¦‚chromeï¼ŒFirefoxï¼ŒIEç­‰ã€‚<br />
                    ğŸ”´ è¯·åŒå­¦ä»¬è‡ªè§‰éµå®ˆäº’è”ç½‘è¡Œä¸ºè§„èŒƒï¼Œå¦‚å‘ç°æ¶æ„è®¿é—®ï¼Œå°†æ³¨é”€è´¦å·å¹¶é€šæŠ¥æ‰€åœ¨å•ä½ã€‚<br />
                    ğŸ”´ ç‰¹åˆ«æ³¨æ„ï¼šå­¦ç”Ÿæ›´æ¢ç­çº§ã€é€€å‡ºç­çº§ï¼Œå¯¹åº”ä½œä¸šæˆ–å°†ä¸¢å¤±ï¼Œè¯·æ“ä½œå‰åŠæ—¶åšå¥½å¤‡ä»½å·¥ä½œï¼
                </div>

                <!-- ä½œä¸šç®¡ç†è¡¨æ ¼ -->
                <table class="table">
                    <thead>
                        <tr>
                            <th>çŠ¶æ€</th>
                            <th>ä½œä¸šæ ‡é¢˜</th>
                            <th>å¸ƒç½®æ—¥æœŸ</th>
                            <th>æˆªè‡³æ—¥æœŸ</th>
                            <th>å‘å¸ƒäºº</th>
                            <th>æ“ä½œ</th>
                            <th>è¯„è¯­</th>
                        </tr>
                    </thead>

                    <tbody id="taskTbody">
                        <!-- ajaxè¯·æ±‚è¿”å›æ•°æ® -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ä½œä¸šè¦æ±‚é®ç½©çª—ä½“ begin-->
    <div class="container">
        <div class="row clearfix">
            <div class="col-md-12 column">
                <div class="modal fade" id="modal-container-418204" role="dialog" aria-labelledby="myModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                                <h4 class="modal-title" id="myModalLabel">
                                    <!-- ä½œä¸šæ ‡é¢˜ ajaxè¿”å› -->

                                </h4>
                            </div>
                            <div class="modal-body" id="demandContext">
                                <!-- ä½œä¸š å†…å®¹... ajaxè¿”å› -->

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">å…³é—­</button>
                                <!-- <button type="button" class="btn btn-primary">ä¿å­˜</button> -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ä½œä¸šè¦æ±‚é®ç½©çª—ä½“ end-->

    <script>
        var courseId = getUrlParam("courseId");
        //è·å–URLä¸­çš„å‚æ•°
        function getUrlParam(name) { //å°è£…æ–¹æ³•
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //æ„é€ ä¸€ä¸ªå«æœ‰ç›®æ ‡å‚æ•°çš„æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡
            var r = window.location.search.substr(1).match(reg); //åŒ¹é…ç›®æ ‡å‚æ•°
            if (r != null) return unescape(r[2]);
            return null; //è¿”å›å‚æ•°å€¼
        };

        function getCourseIdAndTaskId() {
            courseId = getUrlParam("courseId");
            taskId = getUrlParam("taskId");

            console.log("courseId===>" + courseId);
            console.log("taskId===>" + taskId);
        };

        $('#homeWork').click(function () {
            //é¿å…appen()é‡å¤æœ€ä½³å†…å®¹
            $("#taskTbody").empty();
            $.ajax({
                type: "POST", //è¯·æ±‚ç±»å‹
                url: "http://localhost:10001/homeWork/list/"+ courseId,
                // data: //å‘é€åˆ°æœåŠ¡å™¨çš„æ•°æ®ï¼Œè¦æ±‚æ˜¯Objectæˆ–stringç±»å‹çš„å‚æ•°ã€‚å¦‚æœå·²ç»ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå°†è‡ªåŠ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ ¼å¼ã€‚
                dataType: "json", //é¢„æœŸæœåŠ¡å™¨è¿”å›çš„æ•°æ®ç±»å‹
                // crossDomain: true, //å…è®¸è·¨åŸŸè¯·æ±‚
                success: function (result) {
                    if (result.success) {
                        var courseTask = result.data.taskList; //è·å–è¿”å›çš„å­¦ç”Ÿä½œä¸šä¿¡æ¯courseTask
                        //è®¾ç½®è¯¾ç¨‹çš„åå­—
                        if(result.data.courseName){
                            $(".head-title").text(result.data.courseName);
                        }else{
                            $(".head-title").text("è¯¾ç¨‹å¼‚å¸¸");
                        }

                        //è®¾ç½®ç”¨æˆ·åï¼Œä¼ å…¥ç”¨æˆ·å
                        $("div span").text("å¶æ±é“¿");
                        var htmlstr = "";
                        for (var i = 0; i < courseTask.length; i++) {
                            var taskId = courseTask[i].taskId;
                            //$("#taskTbody").append(                      
                            htmlstr += '<tr class="info"><td id="submitState">' +
                                'æœªæäº¤' +
                                '</td><td>' +
                                courseTask[i].taskTitle +
                                '</td><td>' +
                                courseTask[i].createTime.substring(0, 10) +
                                '</td><td>' +
                                courseTask[i].endTime.substring(0, 10) +
                                '</td><td>' +
                                courseTask[i].userName +
                                '</td><td style="padding-left:8px;">'
                                // + '<a style="cursor:pointer;">'
                                +
                                '<a id="modal-418204" onclick="taskDemand(' + taskId +
                                ')" href="#modal-container-418204" role="button" class="btn" data-toggle="modal">' +
                                'ä½œä¸šè¦æ±‚' +
                                '</a>&nbsp;'
                                // + '<a id="tasksubmit" style="cursor:pointer;">å·²äº¤</a>'
                                +
                                '|&nbsp;<a onclick="taskupdate(' + taskId +
                                ')" style="cursor:pointer;">ä¿®æ”¹</a> <input type="file" onchange="selectUploadFile(' +
                                taskId +
                                ')"  style="display:none" id="uploadtask" name="homeWork" multiple/>' +
                                '</td><td>' +
                                'å¾ˆå¥½' +
                                '</td></tr>';

                        };
                        $("#taskTbody").html(htmlstr);

                    }
                }
            });
        });


        //æ‰§è¡Œä½œä¸šçš„æäº¤ä¸ä¿®æ”¹
        function taskupdate(taskId) {
            console.log("taskId===>" + taskId);
            $("#uploadtask").click();
        };

        function selectUploadFile(taskId) {

            var formData = new FormData();
            formData.append('homeWork', $("#uploadtask")[0].files[0]);
            console.log("formdata====>" + formData);
            //å‘é€ajaxä¸Šä¼ æ–‡ä»¶
            $.ajax({
                url: 'http://localhost:10001/uploadHomeWork?taskId='+taskId+'&courseId='+courseId,
                type: 'POST',
                //crossDomain: true, //å…è®¸è·¨åŸŸè¯·æ±‚
                data: formData, //è¯·æ±‚çš„æ•°æ®
                contentType: false, // å½“æœ‰æ–‡ä»¶è¦ä¸Šä¼ æ—¶ï¼Œæ­¤é¡¹æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™åå°æ— æ³•è¯†åˆ«æ–‡ä»¶æµçš„èµ·å§‹ä½ç½®
                processData: false, // æ˜¯å¦åºåˆ—åŒ–dataå±æ€§ï¼Œé»˜è®¤true(æ³¨æ„ï¼šfalseæ—¶typeå¿…é¡»æ˜¯post)
                dataType: 'json', //è¿™é‡Œæ˜¯è¿”å›ç±»å‹ï¼Œä¸€èˆ¬æ˜¯json,textç­‰
                //clearForm: true,//æäº¤åæ˜¯å¦æ¸…ç©ºè¡¨å•æ•°æ®
                success: function (result) { //æäº¤æˆåŠŸåè‡ªåŠ¨æ‰§è¡Œçš„å¤„ç†å‡½æ•°ï¼Œå‚æ•°dataå°±æ˜¯æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€‚
                    if (result.status == 1) {
                        alert('ä¸Šä¼ æˆåŠŸ');

                    } else {
                        alert("ä¸Šä¼ å¤±è´¥ï¼");
                    }

                },
                // error: function() {  //æäº¤å¤±è´¥è‡ªåŠ¨æ‰§è¡Œçš„å¤„ç†å‡½æ•°ã€‚
                //     alert("ä¸Šä¼ æ–‡ä»¶å‡ºç°é”™è¯¯ï¼");
                // }
            });

        };


        // ä½œä¸šè¦æ±‚ï¼š
        function taskDemand(taskId) {

            //å‘é€ajaxä¸Šä¼ æ–‡ä»¶
            $.ajax({
                url: 'http://localhost:10001/queryCourseTask?taskId='+taskId+'&courseId='+courseId,
                type: 'GET',
                //crossDomain: true, //å…è®¸è·¨åŸŸè¯·æ±‚
                // data :  //è¯·æ±‚çš„æ•°æ®
                dataType: 'json', //è¿™é‡Œæ˜¯è¿”å›ç±»å‹ï¼Œä¸€èˆ¬æ˜¯json,textç­‰
                success: function (result) { //æäº¤æˆåŠŸåè‡ªåŠ¨æ‰§è¡Œçš„å¤„ç†å‡½æ•°ï¼Œå‚æ•°dataå°±æ˜¯æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€‚
                    var taskClaim = result.data;
                    if (result.status == 1) {
                        //alert(taskClaim.taskTitle);
                        console.log("taskClaim.taskTitle text()===>" + $("h4.modal-title").text());
                        console.log("taskClaim.taskContent val()===>" + $("#demandContext").text());
                        $("#myModalLabel").text(taskClaim.taskTitle);
                        $("#demandContext").text(taskClaim.taskContent);
                    } else {
                        alert("æŸ¥çœ‹å¤±è´¥ï¼");
                    }
                    // alert("ajaxæ‰§è¡Œå®Œæ¯•ï¼ï¼ï¼");
                },

            });

        };
    </script>

</body>

</html>